# Initialisation de la base de donnÃ©es OpenFoodFacts avec Docker

Ce document dÃ©crit la **mise en place initiale des donnÃ©es** OpenFoodFacts dans un environnement Docker avec MongoDB.  
Lâ€™objectif est de fournir un environnement prÃªt Ã  lâ€™emploi pour le dÃ©veloppement ou les tests avec Spark ou dâ€™autres outils ETL.

---

## ğŸ“‚ Structure des fichiers
```
bulk
â”œâ”€â”€ docker-compose.yml
â”œâ”€â”€ openfoodfacts-mongodbdump.gz
â””â”€â”€ init.sh
```

- **docker-compose.yml** : dÃ©finit les services Docker nÃ©cessaires, notamment MongoDB avec un volume persistant pour conserver les donnÃ©es entre les redÃ©marrages.
- **openfoodfacts-mongodbdump.gz** : archive compressÃ©e contenant le dump MongoDB officiel dâ€™OpenFoodFacts.
- **init.sh** : script dâ€™initialisation pour restaurer la base MongoDB Ã  partir du dump lors du premier dÃ©marrage.

---

## ğŸ³ Docker Compose

Le service MongoDB est configurÃ© pour **conserver les donnÃ©es mÃªme aprÃ¨s un redÃ©marrage** grÃ¢ce Ã  un volume nommÃ© `mongo_data` :

```yaml
volumes:
  mongo_data: {}

services:
  mongo:
    image: mongo:bionic
    container_name: mongo
    restart: always
    ports:
      - "27017:27017"
    volumes:
      - mongo_data:/data/db
      - ${PWD}/openfoodfacts-mongodbdump.gz:/openfoodfacts-mongodbdump.gz
```

Le service mongo-express est configurÃ© pour **se connecter Ã  la base mongodb** :

```yaml
  mongo-express:
    image: mongo-express:latest
    container_name: mongo-express
    restart: always
    ports:
      - "8081:8081"
    environment:
      ME_CONFIG_MONGODB_ADMINUSERNAME: ""
      ME_CONFIG_MONGODB_ADMINPASSWORD: ""
      ME_CONFIG_MONGODB_SERVER: mongo
```

---
## âš™ï¸ Script dâ€™initialisation (init.sh)

Ce script est utilisÃ© pour restaurer le dump MongoDB uniquement si la base est vide, par exemple lors du premier dÃ©marrage du conteneur ou aprÃ¨s une suppression du volume.

```bash
# Se connecter au conteneur MongoDB
docker exec -it mongo bash

# Restaurer la base de donnÃ©es depuis le dump compressÃ©
mongorestore --gzip --archive=/openfoodfacts-mongodbdump.gz

# Quitter le conteneur
exit
```

### ğŸ¯ Objectif

Cette configuration permet :

- Dâ€™avoir une base MongoDB initialisÃ©e avec les donnÃ©es OpenFoodFacts.

- De conserver les donnÃ©es entre les redÃ©marrages grÃ¢ce au volume mongo_data.

- De prÃ©parer lâ€™environnement pour le dÃ©veloppement ETL ou Spark sans manipulations supplÃ©mentaires.

- De reproduire facilement lâ€™environnement sur dâ€™autres machines ou dans un contexte CI/CD.

### ğŸ“Œ Notes

Le script init.sh ne doit Ãªtre exÃ©cutÃ© quâ€™une seule fois si le volume est vide. Les redÃ©marrages ultÃ©rieurs utilisent les donnÃ©es persistantes.

Le conteneur MongoDB est accessible sur le port 27017 pour les applications Spark ou autres clients MongoDB.

Le conteneur Mongo-express est accessible sur le port 8081 sur le navigateur pour naviger dans les bdd mongo, user=admin pass=pass